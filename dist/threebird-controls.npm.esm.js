import{Object3D as t,AnimationMixer as e,PerspectiveCamera as i,Vector3 as n,Quaternion as o,EventDispatcher as a}from"three";import{TweenMax as r}from"gsap";
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var s=function(t,e){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)};function h(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}var p,d,c,l,u,m,g=function(){return(g=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var o in e=arguments[i])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},v=function(){function t(t){for(var e in this.epsilon=.001,this.values={},this.targetValues={},this.deltaValues={},Object.assign(this.values,t.values),Object.assign(this.targetValues,t.values),this.deltaValues={},this.values)this.deltaValues[e]=0;this.dampingFactor=t.dampingFactor,t.epsilon&&(this.epsilon=t.epsilon),this.hasReached=!0}return t.prototype.update=function(){var t={},e=!0;for(var i in this.values)t[i]=this.targetValues[i]-this.values[i],e=e&&Math.abs(t[i])<this.epsilon;if(e){for(var i in this.values)this.deltaValues[i]=t[i],this.values[i]=this.targetValues[i];this.hasReached=!0}else for(var i in this.values)this.deltaValues[i]=this.dampingFactor*t[i],this.values[i]+=this.deltaValues[i]},t.prototype.setTarget=function(t){for(var e in t)this.targetValues[e]=t[e];this.hasReached=!1},t.prototype.addToTarget=function(t,e){this.targetValues[t]+=e,this.hasReached=!1},t.prototype.resetAll=function(t){for(var e in this.values)this.targetValues[e]=t,this.values[e]=t,this.deltaValues[e]=0;this.hasReached=!0},t.prototype.resetData=function(t){for(var e in t)this.targetValues[e]=t[e],this.values[e]=t[e],this.deltaValues[e]=0;this.hasReached=!0},t.prototype.getCurrentValues=function(){return g({},this.values)},t.prototype.getDeltaValues=function(){return g({},this.deltaValues)},t.prototype.reachedTarget=function(){return this.hasReached},t}();!function(t){t.Pan="Pan",t.Tilt="Tilt",t.Roll="Roll",t.Truck="Truck",t.Pedestal="Pedestal",t.Dolly="Dolly",t.LocalTruck="LocalTruck",t.LocalPedestal="LocalPedestal",t.LocalDolly="LocalDolly",t.Zoom="Zoom"}(u||(u={})),function(t){t.X="X",t.Y="Y",t.Z="Z"}(m||(m={}));var y=((p={})[m.X]=((d={})[u.Pan]=m.X,d[u.Tilt]=m.Z,d[u.Roll]=m.Y,d),p[m.Y]=((c={})[u.Pan]=m.Y,c[u.Tilt]=m.X,c[u.Roll]=m.Z,c),p[m.Z]=((l={})[u.Pan]=m.Z,l[u.Tilt]=m.X,l[u.Roll]=m.Y,l),p),f=function(a){function s(t,e,i){var n;void 0===i&&(i={});var o=a.call(this)||this;return o.inTransit=!1,o.upAxis=m.Y,o.actionAxes=y[o.upAxis],o.hasAnimation=!1,o.animationTranslationObjectName="Translation",o.animationRotationObjectName="Rotation",o.respondsToActions=!0,o.translateAlong=((n={})[u.Tilt]=!1,n[u.Pan]=!0,n[u.Roll]=!1,n),o.camera=t,o.scene=e,Object.assign(o,i),o.initRig(),o}return h(s,a),s.prototype.initRig=function(){var e;this.translationBox=new t,this.rotationBox=new t,this.rotationElements=((e={})[m.X]=new t,e[m.Y]=new t,e[m.Z]=new t,e),this.rotationBox.name=this.animationRotationObjectName,this.translationBox.name=this.animationTranslationObjectName,this.translationBox.rotation.order=this.getRotationOrder();var i=this.rotationElements[this.actionAxes[u.Pan]],n=this.rotationElements[this.actionAxes[u.Tilt]],o=this.rotationElements[this.actionAxes[u.Roll]];this.scene.add(this.translationBox.add(this.rotationBox.add(i.add(n.add(o.add(this.camera)))))),this.cameraIsInRig=!0},s.prototype.rotateRigComponent=function(t,e,i){switch(e){case m.X:t.rotateX(i);break;case m.Y:t.rotateY(i);break;case m.Z:t.rotateZ(i)}},s.prototype.rotate=function(t,e){var i=this.actionAxes[t];this.translateAlong[t]?this.rotateRigComponent(this.translationBox,i,e):this.rotateRigComponent(this.rotationElements[i],i,e)},s.prototype.translateRigComponent=function(t,e,i){switch(e){case m.X:t.translateX(i);break;case m.Y:t.translateY(i);break;case m.Z:t.translateZ(i)}},s.prototype.setAnimationClip=function(t,i,n){this.animationClip=t,i&&(this.animationTranslationObjectName=i),n&&(this.animationRotationObjectName=n),this.hasAnimation=!0,this.mixer=new e(this.translationBox),this.mixer.clipAction(this.animationClip).play(),this.mixer.setTime(0)},s.prototype.do=function(t,e){if(this.respondsToActions)switch(t){case u.Pan:case u.Tilt:case u.Roll:this.rotate(t,e);break;case u.Truck:this.translateRigComponent(this.translationBox,this.actionAxes[u.Tilt],e);break;case u.Pedestal:this.translateRigComponent(this.translationBox,this.actionAxes[u.Pan],e);break;case u.Dolly:this.translateRigComponent(this.translationBox,this.actionAxes[u.Roll],e);break;case u.LocalTruck:var n=this.actionAxes[u.Tilt];this.translateRigComponent(this.rotationElements[n],n,e);break;case u.LocalPedestal:n=this.actionAxes[u.Pan];this.translateRigComponent(this.rotationElements[n],n,e);break;case u.LocalDolly:n=this.actionAxes[u.Roll];this.translateRigComponent(this.rotationElements[n],n,e);break;case u.Zoom:this.camera instanceof i&&(this.camera.fov=e,this.camera.updateProjectionMatrix())}},s.prototype.freezeTransform=function(){var t=this.getWorldCoordinates(),e=t.position,i=t.quaternion;for(var n in this.translationBox.position.copy(e),this.translationBox.rotation.set(0,0,0),this.rotationBox.quaternion.copy(i),this.rotationBox.position.set(0,0,0),this.rotationElements)this.rotationElements[n].position.set(0,0,0),this.rotationElements[n].rotation.set(0,0,0)},s.prototype.disassemble=function(){this.cameraIsInRig&&(this.scene.attach(this.camera),this.cameraIsInRig=!1)},s.prototype.assemble=function(){if(!this.cameraIsInRig){var t=this.getWorldCoordinates(),e=t.position,i=t.quaternion;this.translationBox.position.copy(e),this.rotationBox.quaternion.copy(i),this.rotationElements[this.actionAxes[u.Roll]].attach(this.camera),this.cameraIsInRig=!0}},s.prototype.isInRig=function(){return this.cameraIsInRig},s.prototype.getRotationOrder=function(){return Object.values(this.actionAxes).join("")},s.prototype.getWorldCoordinates=function(){var t=new n;this.camera.getWorldPosition(t);var e=new o;return this.camera.getWorldQuaternion(e),{position:t,quaternion:e}},s.prototype.isMoving=function(){return this.inTransit},s.prototype.setUpAxis=function(t){var e=this.actionAxes;this.upAxis=t,this.actionAxes=y[this.upAxis];var i=this.rotationElements[e[u.Pan]],n=this.rotationElements[e[u.Tilt]],o=this.rotationElements[e[u.Roll]];this.rotationElements[this.actionAxes[u.Pan]]=i,this.rotationElements[this.actionAxes[u.Tilt]]=n,this.rotationElements[this.actionAxes[u.Roll]]=o,this.translationBox.rotation.order=this.getRotationOrder()},s.prototype.flyTo=function(t,e,i,n){var o=this;if(void 0===i&&(i=1),void 0===n&&(n="power1"),!this.isMoving()){var a=this.getWorldCoordinates(),s={px:a.position.x,py:a.position.y,pz:a.position.z,qx:a.quaternion.x,qy:a.quaternion.y,qz:a.quaternion.z,qw:a.quaternion.w},h={px:t.x,py:t.y,pz:t.z,qx:e.x,qy:e.y,qz:e.z,qw:e.w};r.to(s,g(g({duration:i,ease:n},h),{onStart:function(){o.inTransit=!0,o.disassemble(),o.dispatchEvent({type:"CameraMoveStart"})},onUpdate:function(){var t;t=this,o.camera.position.set(s.px,s.py,s.pz),o.camera.quaternion.set(s.qx,s.qy,s.qz,s.qw),o.dispatchEvent({type:"CameraMoveUpdate",progress:t.progress()})},onComplete:function(){o.assemble(),o.inTransit=!1,o.dispatchEvent({type:"CameraMoveEnd"})}}))}},s.prototype.flyToKeyframe=function(t,e,i){var n=this;if(void 0===e&&(e=1),void 0===i&&(i="power1"),this.hasAnimation&&!this.isMoving()){var o={time:this.mixer.time},a={time:this.animationClip.tracks[0].times[t]};r.to(o,g(g({duration:e,ease:i},a),{onStart:function(){n.inTransit=!0,n.dispatchEvent({type:"CameraMoveStart"})},onUpdate:function(){var t;t=this,n.mixer.setTime(o.time),n.dispatchEvent({type:"CameraMoveUpdate",progress:t.progress()})},onComplete:function(){n.inTransit=!1,n.dispatchEvent({type:"CameraMoveEnd"})}}))}},s.prototype.setAnimationPercentage=function(t){if(this.hasAnimation){var e=Math.max(0,Math.min(t*this.animationClip.duration,this.animationClip.duration-1e-4));this.mixer.setTime(e)}},s.prototype.setAnimationTime=function(t){this.hasAnimation&&this.mixer.setTime(t)},s.prototype.setAnimationKeyframe=function(t){this.hasAnimation&&this.mixer.setTime(this.animationClip.tracks[0].times[t])},s}(a),b=function(t){function e(){return t.call(this)||this}return h(e,t),e}(a),E=function(t){function e(e){var i=t.call(this)||this;i.dampingFactor=.5,i.incrementor=1,i.keyMapping={up:["ArrowUp","w","W"],down:["ArrowDown","s","S"],left:["ArrowLeft","a","A"],right:["ArrowRight","d","D"]},i.preventBubbling=!0,Object.assign(i,e);var n={};for(var o in i.keyMapping)n[o]=0;return i.damper=new v({values:n,dampingFactor:i.dampingFactor}),i.onKeyUp=i.onKeyUp.bind(i),i.onKeyDown=i.onKeyDown.bind(i),i}return h(e,t),e.prototype.connect=function(){document.addEventListener("keyup",this.onKeyUp,!0),document.addEventListener("keydown",this.onKeyDown,!0),this.connected=!0},e.prototype.disconnect=function(){document.removeEventListener("keyup",this.onKeyUp,!0),document.removeEventListener("keydown",this.onKeyDown,!0),this.connected=!1},e.prototype.update=function(){"continuous"!==this.type||this.damper.reachedTarget()||(this.damper.update(),this.dispatchEvent({type:"update",values:this.damper.getCurrentValues(),deltas:this.damper.getDeltaValues()}),this.damper.reachedTarget()&&(this.damper.resetAll(0),this.dispatchEvent({type:"inertiacomplete"})))},e.prototype.isEnabled=function(){return this.connected},e.prototype.onKeyUp=function(t){if("discrete"===this.type)for(var e in this.keyMapping)if(this.keyMapping[e].includes(t.key)){this.preventBubbling&&t.preventDefault(),this.dispatchEvent({type:"trigger",trigger:e});break}},e.prototype.onKeyDown=function(t){if("continuous"===this.type)for(var e in this.keyMapping)if(this.keyMapping[e].includes(t.key)){this.preventBubbling&&t.preventDefault(),this.damper.addToTarget(e,this.incrementor);break}},e}(b),w=function(t){function e(e){var i=t.call(this)||this;return i.dampingFactor=.5,i.domElement=document.body,i.shouldNormalize=!0,i.normalizeAroundZero=!0,i.pointerCount=0,i.recordedPosition=!1,i.cache=[],i.lastDownTime=0,i.lastUpTime=0,i.multipointerThreshold=100,Object.assign(i,e),i.damper=new v({values:{x:null,y:null},dampingFactor:i.dampingFactor}),i.setDimensions(),i.onPointerMove=i.onPointerMove.bind(i),i.onPointerUp=i.onPointerUp.bind(i),i.onPointerDown=i.onPointerDown.bind(i),i.onResize=i.onResize.bind(i),i}return h(e,t),e.prototype.connect=function(){this.domElement.addEventListener("pointermove",this.onPointerMove,{passive:!0}),this.domElement.addEventListener("pointerdown",this.onPointerDown,{passive:!0}),this.domElement.addEventListener("pointerleave",this.onPointerUp,{passive:!0}),this.domElement.addEventListener("pointerup",this.onPointerUp,{passive:!0}),window.addEventListener("resize",this.onResize),this.connected=!0},e.prototype.disconnect=function(){this.domElement.removeEventListener("pointermove",this.onPointerMove),this.domElement.removeEventListener("pointerdown",this.onPointerDown),this.domElement.removeEventListener("pointerleave",this.onPointerUp),this.domElement.removeEventListener("pointerup",this.onPointerUp),this.connected=!1},e.prototype.update=function(t){this.pointerCount!==this.cache.length&&t-this.lastDownTime>this.multipointerThreshold&&t-this.lastUpTime>this.multipointerThreshold&&(this.pointerCount=this.cache.length,0===this.pointerCount?(this.damper.resetAll(null),this.recordedPosition=!1):(this.damper.resetData(this.getPointerPosition(this.cache[0])),this.recordedPosition=!0)),this.damper.reachedTarget()||(this.damper.update(),this.dispatchEvent({type:"update",values:this.shouldNormalize?this.normalize(this.damper.getCurrentValues(),this.normalizeAroundZero):this.damper.getCurrentValues(),deltas:this.shouldNormalize?this.normalize(this.damper.getDeltaValues(),!1):this.damper.getDeltaValues(),pointerCount:this.pointerCount}),this.damper.reachedTarget()&&this.dispatchEvent({type:"inertiacomplete"}))},e.prototype.isEnabled=function(){return this.connected},e.prototype.setDimensions=function(){this.width=this.domElement.getBoundingClientRect().width,this.height=this.domElement.getBoundingClientRect().height},e.prototype.getPointerPosition=function(t){return{x:Math.max(0,Math.min(this.width,t.x-this.domElement.offsetLeft)),y:Math.max(0,Math.min(this.height,t.y-this.domElement.offsetTop))}},e.prototype.normalize=function(t,e){var i=t.x/this.width,n=t.y/this.height;return e&&(i=2*i-1,n=2*n-1),{x:i,y:n}},e.prototype.onPointerMove=function(t){this.pointerCount===this.cache.length&&(0===this.cache.length?this.recordedPosition?this.damper.setTarget(this.getPointerPosition(t)):(this.damper.resetData(this.getPointerPosition(t)),this.recordedPosition=!0):t.pointerId===this.cache[0].pointerId&&this.damper.setTarget(this.getPointerPosition(t)))},e.prototype.onPointerDown=function(t){0===t.button&&(this.cache.push(t),this.lastDownTime=window.performance.now())},e.prototype.onPointerUp=function(t){if(0===t.button||"pointerleave"===t.type){for(var e=0;e<this.cache.length;e++)if(this.cache[e].pointerId==t.pointerId){this.cache.splice(e,1);break}this.lastUpTime=window.performance.now()}},e.prototype.onResize=function(){this.setDimensions()},e}(b),x=function(t){function e(e){var i=t.call(this)||this;return i.dampingFactor=.5,i.isIntersecting=!1,Object.assign(i,e),i.values={head:0,body:0,foot:0,total:0},i.lastSeenScrollValue=0,i.damper=new v({values:i.values,dampingFactor:i.dampingFactor}),i.onIntersected=i.onIntersected.bind(i),i.observer=new IntersectionObserver(i.onIntersected),i}return h(e,t),e.prototype.connect=function(){this.observer.observe(this.scrollElement),this.connected=!0},e.prototype.disconnect=function(){this.observer.unobserve(this.scrollElement),this.connected=!1},e.prototype.update=function(){if(this.isIntersecting&&this.lastSeenScrollValue!==(this.scrollParent?this.scrollParent.scrollTop:window.scrollY)){this.lastSeenScrollValue=this.scrollParent?this.scrollParent.scrollTop:window.scrollY;var t=this.scrollElement.getBoundingClientRect();this.values.head=this.normalize(t.top,window.innerHeight,0),this.values.foot=this.normalize(t.bottom,window.innerHeight,0),this.values.body=this.normalize(t.top,0,window.innerHeight-t.height),this.values.total=this.normalize(t.top,window.innerHeight,-t.height),this.damper.setTarget(this.values)}this.damper.reachedTarget()||(this.damper.update(),this.dispatchEvent({type:"update",dampenedValues:this.damper.getCurrentValues(),values:this.values}),this.damper.reachedTarget()&&this.dispatchEvent({type:"inertiacomplete"}))},e.prototype.isEnabled=function(){return this.connected},e.prototype.normalize=function(t,e,i){var n=(t-e)/(i-e);return Math.max(0,Math.min(1,n))},e.prototype.onIntersected=function(t){var e=t[0];this.isIntersecting=e.isIntersecting},e}(b),P=function(t){function e(e){void 0===e&&(e={});var i=t.call(this)||this;return i.domElement=document.body,i.thresholdX=60,i.thresholdY=60,Object.assign(i,e),i.onPointerUp=i.onPointerUp.bind(i),i.onPointerDown=i.onPointerDown.bind(i),i}return h(e,t),e.prototype.connect=function(){this.domElement.addEventListener("pointerdown",this.onPointerDown,{passive:!0}),this.domElement.addEventListener("pointerup",this.onPointerUp,{passive:!0}),this.connected=!0},e.prototype.disconnect=function(){this.domElement.removeEventListener("pointerdown",this.onPointerDown),this.domElement.removeEventListener("pointerup",this.onPointerUp),this.connected=!1},e.prototype.update=function(){},e.prototype.isEnabled=function(){return this.connected},e.prototype.onPointerDown=function(t){"mouse"!==t.pointerType&&t.isPrimary&&(this.startX=t.screenX,this.startY=t.screenY)},e.prototype.onPointerUp=function(t){if("mouse"!==t.pointerType&&t.isPrimary){var e=t.screenX-this.startX,i=t.screenY-this.startY;(Math.abs(e)>=this.thresholdX||Math.abs(i)>=this.thresholdY)&&this.dispatchEvent({type:"trigger",x:Math.abs(e)>=this.thresholdX?Math.sign(e):0,y:Math.abs(i)>=this.thresholdY?Math.sign(-1*i):0})}},e}(b),T=function(t){function e(e){var i=t.call(this)||this;return i.dampingFactor=.5,i.thresholdX=15,i.thresholdY=15,i.debounceDuration=700,i.lastThresholdTrigger=0,Object.assign(i,e),i.damper=new v({values:{x:0,y:0},dampingFactor:i.dampingFactor}),i.onWheel=i.onWheel.bind(i),i}return h(e,t),e.prototype.connect=function(){(this.domElement||window).addEventListener("wheel",this.onWheel,{passive:!0}),this.connected=!0},e.prototype.disconnect=function(){(this.domElement||window).removeEventListener("wheel",this.onWheel),this.connected=!1},e.prototype.update=function(){"continuous"!==this.type||this.damper.reachedTarget()||(this.damper.update(),this.dispatchEvent({type:"update",values:this.damper.getCurrentValues(),deltas:this.damper.getDeltaValues()}),this.damper.reachedTarget()&&(this.damper.resetAll(0),this.dispatchEvent({type:"inertiacomplete"})))},e.prototype.isEnabled=function(){return this.connected},e.prototype.onWheel=function(t){if("continuous"===this.type)this.damper.addToTarget("x",t.deltaX),this.damper.addToTarget("y",t.deltaY);else if("discrete"===this.type&&(Math.abs(t.deltaX)>=this.thresholdX||Math.abs(t.deltaY)>=this.thresholdY)){var e=window.performance.now();e-this.lastThresholdTrigger>this.debounceDuration&&(this.lastThresholdTrigger=e,this.dispatchEvent({type:"trigger",x:Math.abs(t.deltaX)>=this.thresholdX?Math.sign(t.deltaX):0,y:Math.abs(t.deltaY)>=this.thresholdY?Math.sign(t.deltaY):0}))}},e}(b),A=function(){function t(t,e){void 0===e&&(e={}),this.enabled=!1,this.cameraRig=t,this.wheelScaleFactor=e.wheelScaleFactor||.05,this.pointerScaleFactor=e.pointerScaleFactor||4,this.panDegreeFactor=e.panDegreeFactor||Math.PI/4,this.tiltDegreeFactor=e.tiltDegreeFactor||Math.PI/10,this.keyboardAdaptor=new E({type:"continuous",dampingFactor:e.keyboardDampFactor||.5,incrementor:e.keyboardScaleFactor||.5,keyMapping:{forward:["ArrowUp","w","W"],backward:["ArrowDown","s","S"],left:["ArrowLeft","a","A"],right:["ArrowRight","d","D"],up:["t","T"],down:["b","B"]}}),this.wheelAdaptor=new T({type:"continuous",dampingFactor:e.wheelDampFactor||.25,domElement:e.domElement||document.body}),this.pointerAdaptor=new w({dampingFactor:e.pointerDampFactor||.3}),this.onWheel=this.onWheel.bind(this),this.onKey=this.onKey.bind(this),this.onPointer=this.onPointer.bind(this)}return t.prototype.isEnabled=function(){return this.enabled},t.prototype.enable=function(){this.wheelAdaptor.connect(),this.keyboardAdaptor.connect(),this.pointerAdaptor.connect(),this.wheelAdaptor.addEventListener("update",this.onWheel),this.keyboardAdaptor.addEventListener("update",this.onKey),this.pointerAdaptor.addEventListener("update",this.onPointer),this.enabled=!0},t.prototype.disable=function(){this.wheelAdaptor.disconnect(),this.keyboardAdaptor.disconnect(),this.pointerAdaptor.disconnect(),this.wheelAdaptor.removeEventListener("update",this.onWheel),this.keyboardAdaptor.removeEventListener("update",this.onKey),this.pointerAdaptor.removeEventListener("update",this.onPointer),this.enabled=!1},t.prototype.onWheel=function(t){this.cameraRig.do(u.Dolly,t.deltas.y*this.wheelScaleFactor),this.cameraRig.do(u.Truck,t.deltas.x*this.wheelScaleFactor)},t.prototype.onKey=function(t){this.cameraRig.do(u.Dolly,t.values.backward-t.values.forward),this.cameraRig.do(u.Truck,t.values.right-t.values.left),this.cameraRig.do(u.Pedestal,t.values.up-t.values.down)},t.prototype.onPointer=function(t){switch(t.pointerCount){case 1:this.cameraRig.do(u.Pan,t.deltas.x*this.panDegreeFactor),this.cameraRig.do(u.Tilt,t.deltas.y*this.tiltDegreeFactor);break;case 2:this.cameraRig.do(u.Dolly,-t.deltas.y*this.pointerScaleFactor),this.cameraRig.do(u.Truck,-t.deltas.x*this.pointerScaleFactor)}},t.prototype.update=function(t){this.enabled&&(this.keyboardAdaptor.update(),this.wheelAdaptor.update(),this.pointerAdaptor.update(t))},t}(),C=function(){function t(t,e){this.enabled=!1,this.cameraRig=t,this.cameraRig.setAnimationTime(0),this.scrollAdaptor=new x({scrollElement:e.scrollElement,scrollParent:e.scrollParent,dampingFactor:e.dampingFactor||1}),this.onScroll=this.onScroll.bind(this)}return t.prototype.isEnabled=function(){return this.enabled},t.prototype.enable=function(){this.scrollAdaptor.connect(),this.scrollAdaptor.addEventListener("update",this.onScroll),this.enabled=!0},t.prototype.disable=function(){this.scrollAdaptor.disconnect(),this.scrollAdaptor.removeEventListener("update",this.onScroll),this.enabled=!1},t.prototype.update=function(){this.enabled&&this.scrollAdaptor.update()},t.prototype.onScroll=function(t){this.cameraRig.setAnimationPercentage(t.values.total)},t}(),R=function(t){function e(e,i,n){void 0===i&&(i=[]),void 0===n&&(n={});var o=t.call(this)||this;return o.currentIndex=null,o.upcomingIndex=null,o.enabled=!1,o.cycle=!1,o.cameraRig=e,o.pois=i,Object.assign(o,n),o.onCameraStart=o.onCameraStart.bind(o),o.onCameraUpdate=o.onCameraUpdate.bind(o),o.onCameraEnd=o.onCameraEnd.bind(o),o}return h(e,t),e.prototype.getCurrentIndex=function(){return this.currentIndex},e.prototype.nextPOI=function(){var t=this.currentIndex+1;t>=this.pois.length&&!this.cycle?this.dispatchEvent({type:"ExitStoryPoints",exitFrom:"end"}):this.goToPOI(t%this.pois.length)},e.prototype.prevPOI=function(){var t=this.currentIndex-1;t<0&&!this.cycle?this.dispatchEvent({type:"ExitStoryPoints",exitFrom:"start"}):this.goToPOI((t+this.pois.length)%this.pois.length)},e.prototype.goToPOI=function(t){this.upcomingIndex=t;var e=this.pois[this.upcomingIndex];this.cameraRig.flyTo(e.lookAtPosition,e.lookAtOrientation,this.duration,this.ease)},e.prototype.enable=function(){this.cameraRig.addEventListener("CameraMoveStart",this.onCameraStart),this.cameraRig.addEventListener("CameraMoveUpdate",this.onCameraUpdate),this.cameraRig.addEventListener("CameraMoveEnd",this.onCameraEnd),this.enabled=!0},e.prototype.disable=function(){this.cameraRig.removeEventListener("CameraMoveStart",this.onCameraStart),this.cameraRig.removeEventListener("CameraMoveUpdate",this.onCameraUpdate),this.cameraRig.removeEventListener("CameraMoveEnd",this.onCameraEnd),this.enabled=!1},e.prototype.update=function(){},e.prototype.isEnabled=function(){return this.enabled},e.prototype.updatePois=function(t){this.dispatchEvent({type:"update",currentIndex:this.currentIndex,upcomingIndex:this.upcomingIndex,progress:t})},e.prototype.onCameraStart=function(){this.updatePois(0)},e.prototype.onCameraUpdate=function(t){this.updatePois(t.progress)},e.prototype.onCameraEnd=function(){this.currentIndex=this.upcomingIndex,this.upcomingIndex=null},e}(a),I=function(t){function e(e,i,n){void 0===i&&(i=[]),void 0===n&&(n={});var o=t.call(this)||this;return o.currentIndex=0,o.upcomingIndex=null,o.enabled=!1,o.wheelThreshold=15,o.swipeThreshold=60,o.cameraRig=e,o.pois=i,Object.assign(o,n),o.wheelAdaptor=new T({type:"discrete",thresholdY:o.wheelThreshold}),o.swipeAdaptor=new P({thresholdY:o.swipeThreshold}),o.keyboardAdaptor=new E({type:"discrete"}),o.onCameraStart=o.onCameraStart.bind(o),o.onCameraUpdate=o.onCameraUpdate.bind(o),o.onCameraEnd=o.onCameraEnd.bind(o),o.onTrigger=o.onTrigger.bind(o),o.onKey=o.onKey.bind(o),o}return h(e,t),e.prototype.getCurrentIndex=function(){return this.currentIndex},e.prototype.enable=function(){this.wheelAdaptor.addEventListener("trigger",this.onTrigger),this.swipeAdaptor.addEventListener("trigger",this.onTrigger),this.keyboardAdaptor.addEventListener("trigger",this.onKey),this.cameraRig.addEventListener("CameraMoveStart",this.onCameraStart),this.cameraRig.addEventListener("CameraMoveUpdate",this.onCameraUpdate),this.cameraRig.addEventListener("CameraMoveEnd",this.onCameraEnd),this.wheelAdaptor.connect(),this.swipeAdaptor.connect(),this.keyboardAdaptor.connect(),this.enabled=!0},e.prototype.disable=function(){this.wheelAdaptor.removeEventListener("trigger",this.onTrigger),this.swipeAdaptor.removeEventListener("trigger",this.onTrigger),this.keyboardAdaptor.removeEventListener("trigger",this.onKey),this.cameraRig.removeEventListener("CameraMoveStart",this.onCameraStart),this.cameraRig.removeEventListener("CameraMoveUpdate",this.onCameraUpdate),this.cameraRig.removeEventListener("CameraMoveEnd",this.onCameraEnd),this.wheelAdaptor.disconnect(),this.swipeAdaptor.disconnect(),this.keyboardAdaptor.disconnect(),this.enabled=!1},e.prototype.update=function(){},e.prototype.isEnabled=function(){return this.enabled},e.prototype.onKey=function(t){switch(t.trigger){case"up":this.onTrigger({y:-1});break;case"down":this.onTrigger({y:1})}},e.prototype.onTrigger=function(t){var e=this.currentIndex+t.y;e>=this.pois.length?this.dispatchEvent({type:"ExitPathPoints",exitFrom:"end"}):e<0?this.dispatchEvent({type:"ExitPathPoints",exitFrom:"start"}):(this.upcomingIndex=e,this.cameraRig.flyToKeyframe(this.pois[this.upcomingIndex].frame,this.duration,this.ease))},e.prototype.updatePois=function(t){this.dispatchEvent({type:"update",currentIndex:this.currentIndex,upcomingIndex:this.upcomingIndex,progress:t})},e.prototype.onCameraStart=function(){this.updatePois(0)},e.prototype.onCameraUpdate=function(t){this.updatePois(t.progress)},e.prototype.onCameraEnd=function(){this.currentIndex=this.upcomingIndex,this.upcomingIndex=null},e}(a),M=function(){function t(t,e){void 0===e&&(e={}),this.enabled=!1,this.panFactor=Math.PI/20,this.tiltFactor=Math.PI/20,this.truckFactor=1,this.pedestalFactor=1,this.dampingFactor=.7,this.cameraRig=t,Object.assign(this,e),this.pointerAdaptor=new w({dampingFactor:this.dampingFactor}),this.onPointerMove=this.onPointerMove.bind(this)}return t.prototype.isEnabled=function(){return this.enabled},t.prototype.enable=function(){this.pointerAdaptor.connect(),this.pointerAdaptor.addEventListener("update",this.onPointerMove),this.enabled=!0},t.prototype.disable=function(){this.pointerAdaptor.disconnect(),this.pointerAdaptor.removeEventListener("update",this.onPointerMove),this.enabled=!1},t.prototype.update=function(t){this.enabled&&this.pointerAdaptor.update(t)},t.prototype.onPointerMove=function(t){0===t.pointerCount&&(this.cameraRig.do(u.Pan,-t.deltas.x*this.panFactor),this.cameraRig.do(u.Tilt,-t.deltas.y*this.tiltFactor),this.cameraRig.do(u.LocalTruck,t.deltas.x*this.truckFactor),this.cameraRig.do(u.LocalPedestal,t.deltas.y*this.pedestalFactor))},t}();export{m as Axis,b as BaseAdaptor,u as CameraAction,f as CameraRig,v as Damper,A as FreeMovementControls,E as KeyboardAdaptor,I as PathPointsControls,w as PointerAdaptor,x as ScrollAdaptor,C as ScrollControls,R as StoryPointsControls,P as SwipeAdaptor,M as ThreeDOFControls,T as WheelAdaptor};
//# sourceMappingURL=threebird-controls.npm.esm.js.map
