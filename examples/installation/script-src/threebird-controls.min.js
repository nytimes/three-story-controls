!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("three"),require("gsap")):"function"==typeof define&&define.amd?define(["exports","three","gsap"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).ThreebirdControls={},t.THREE,t.gsap)}(this,(function(t,e,i){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)};function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}var a,r,s,h,c,p,d=function(){return(d=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var o in e=arguments[i])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},l=function(){function t(t){for(var e in this.epsilon=.001,this.values={},this.targetValues={},this.deltaValues={},Object.assign(this.values,t.values),Object.assign(this.targetValues,t.values),this.deltaValues={},this.values)this.deltaValues[e]=0;this.dampingFactor=t.dampingFactor,t.epsilon&&(this.epsilon=t.epsilon),this.hasReached=!0}return t.prototype.update=function(){var t={},e=!0;for(var i in this.values)t[i]=this.targetValues[i]-this.values[i],e=e&&Math.abs(t[i])<this.epsilon;if(e){for(var i in this.values)this.deltaValues[i]=t[i],this.values[i]=this.targetValues[i];this.hasReached=!0}else for(var i in this.values)this.deltaValues[i]=this.dampingFactor*t[i],this.values[i]+=this.deltaValues[i]},t.prototype.setTarget=function(t){for(var e in t)this.targetValues[e]=t[e];this.hasReached=!1},t.prototype.addToTarget=function(t,e){this.targetValues[t]+=e,this.hasReached=!1},t.prototype.resetAll=function(t){for(var e in this.values)this.targetValues[e]=t,this.values[e]=t,this.deltaValues[e]=0;this.hasReached=!0},t.prototype.resetData=function(t){for(var e in t)this.targetValues[e]=t[e],this.values[e]=t[e],this.deltaValues[e]=0;this.hasReached=!0},t.prototype.getCurrentValues=function(){return d({},this.values)},t.prototype.getDeltaValues=function(){return d({},this.deltaValues)},t.prototype.reachedTarget=function(){return this.hasReached},t}();t.CameraAction=void 0,(c=t.CameraAction||(t.CameraAction={})).Pan="Pan",c.Tilt="Tilt",c.Roll="Roll",c.Truck="Truck",c.Pedestal="Pedestal",c.Dolly="Dolly",c.LocalTruck="LocalTruck",c.LocalPedestal="LocalPedestal",c.LocalDolly="LocalDolly",c.Zoom="Zoom",t.Axis=void 0,(p=t.Axis||(t.Axis={})).X="X",p.Y="Y",p.Z="Z";var m=((a={})[t.Axis.X]=((r={})[t.CameraAction.Pan]=t.Axis.X,r[t.CameraAction.Tilt]=t.Axis.Z,r[t.CameraAction.Roll]=t.Axis.Y,r),a[t.Axis.Y]=((s={})[t.CameraAction.Pan]=t.Axis.Y,s[t.CameraAction.Tilt]=t.Axis.X,s[t.CameraAction.Roll]=t.Axis.Z,s),a[t.Axis.Z]=((h={})[t.CameraAction.Pan]=t.Axis.Z,h[t.CameraAction.Tilt]=t.Axis.X,h[t.CameraAction.Roll]=t.Axis.Y,h),a),u=function(n){function a(e,i,o){var a;void 0===o&&(o={});var r=n.call(this)||this;return r.inTransit=!1,r.upAxis=t.Axis.Y,r.actionAxes=m[r.upAxis],r.hasAnimation=!1,r.animationTranslationObjectName="Translation",r.animationRotationObjectName="Rotation",r.respondsToActions=!0,r.translateAlong=((a={})[t.CameraAction.Tilt]=!1,a[t.CameraAction.Pan]=!0,a[t.CameraAction.Roll]=!1,a),r.camera=e,r.scene=i,Object.assign(r,o),r.initRig(),r}return o(a,n),a.prototype.initRig=function(){var i;this.translationBox=new e.Object3D,this.rotationBox=new e.Object3D,this.rotationElements=((i={})[t.Axis.X]=new e.Object3D,i[t.Axis.Y]=new e.Object3D,i[t.Axis.Z]=new e.Object3D,i),this.rotationBox.name=this.animationRotationObjectName,this.translationBox.name=this.animationTranslationObjectName,this.translationBox.rotation.order=this.getRotationOrder();var n=this.rotationElements[this.actionAxes[t.CameraAction.Pan]],o=this.rotationElements[this.actionAxes[t.CameraAction.Tilt]],a=this.rotationElements[this.actionAxes[t.CameraAction.Roll]];this.scene.add(this.translationBox.add(this.rotationBox.add(n.add(o.add(a.add(this.camera)))))),this.cameraIsInRig=!0},a.prototype.rotateRigComponent=function(e,i,n){switch(i){case t.Axis.X:e.rotateX(n);break;case t.Axis.Y:e.rotateY(n);break;case t.Axis.Z:e.rotateZ(n)}},a.prototype.rotate=function(t,e){var i=this.actionAxes[t];this.translateAlong[t]?this.rotateRigComponent(this.translationBox,i,e):this.rotateRigComponent(this.rotationElements[i],i,e)},a.prototype.translateRigComponent=function(e,i,n){switch(i){case t.Axis.X:e.translateX(n);break;case t.Axis.Y:e.translateY(n);break;case t.Axis.Z:e.translateZ(n)}},a.prototype.setAnimationClip=function(t,i,n){this.animationClip=t,i&&(this.animationTranslationObjectName=i),n&&(this.animationRotationObjectName=n),this.hasAnimation=!0,this.mixer=new e.AnimationMixer(this.translationBox),this.mixer.clipAction(this.animationClip).play(),this.mixer.setTime(0)},a.prototype.do=function(i,n){if(this.respondsToActions)switch(i){case t.CameraAction.Pan:case t.CameraAction.Tilt:case t.CameraAction.Roll:this.rotate(i,n);break;case t.CameraAction.Truck:this.translateRigComponent(this.translationBox,this.actionAxes[t.CameraAction.Tilt],n);break;case t.CameraAction.Pedestal:this.translateRigComponent(this.translationBox,this.actionAxes[t.CameraAction.Pan],n);break;case t.CameraAction.Dolly:this.translateRigComponent(this.translationBox,this.actionAxes[t.CameraAction.Roll],n);break;case t.CameraAction.LocalTruck:var o=this.actionAxes[t.CameraAction.Tilt];this.translateRigComponent(this.rotationElements[o],o,n);break;case t.CameraAction.LocalPedestal:o=this.actionAxes[t.CameraAction.Pan];this.translateRigComponent(this.rotationElements[o],o,n);break;case t.CameraAction.LocalDolly:o=this.actionAxes[t.CameraAction.Roll];this.translateRigComponent(this.rotationElements[o],o,n);break;case t.CameraAction.Zoom:this.camera instanceof e.PerspectiveCamera&&(this.camera.fov=n,this.camera.updateProjectionMatrix())}},a.prototype.freezeTransform=function(){var t=this.getWorldCoordinates(),e=t.position,i=t.quaternion;for(var n in this.translationBox.position.copy(e),this.translationBox.rotation.set(0,0,0),this.rotationBox.quaternion.copy(i),this.rotationBox.position.set(0,0,0),this.rotationElements)this.rotationElements[n].position.set(0,0,0),this.rotationElements[n].rotation.set(0,0,0)},a.prototype.disassemble=function(){this.cameraIsInRig&&(this.scene.attach(this.camera),this.cameraIsInRig=!1)},a.prototype.assemble=function(){if(!this.cameraIsInRig){var e=this.getWorldCoordinates(),i=e.position,n=e.quaternion;this.translationBox.position.copy(i),this.rotationBox.quaternion.copy(n),this.rotationElements[this.actionAxes[t.CameraAction.Roll]].attach(this.camera),this.cameraIsInRig=!0}},a.prototype.isInRig=function(){return this.cameraIsInRig},a.prototype.getRotationOrder=function(){return Object.values(this.actionAxes).join("")},a.prototype.getWorldCoordinates=function(){var t=new e.Vector3;this.camera.getWorldPosition(t);var i=new e.Quaternion;return this.camera.getWorldQuaternion(i),{position:t,quaternion:i}},a.prototype.isMoving=function(){return this.inTransit},a.prototype.setUpAxis=function(e){var i=this.actionAxes;this.upAxis=e,this.actionAxes=m[this.upAxis];var n=this.rotationElements[i[t.CameraAction.Pan]],o=this.rotationElements[i[t.CameraAction.Tilt]],a=this.rotationElements[i[t.CameraAction.Roll]];this.rotationElements[this.actionAxes[t.CameraAction.Pan]]=n,this.rotationElements[this.actionAxes[t.CameraAction.Tilt]]=o,this.rotationElements[this.actionAxes[t.CameraAction.Roll]]=a,this.translationBox.rotation.order=this.getRotationOrder()},a.prototype.flyTo=function(t,e,n,o){var a=this;if(void 0===n&&(n=1),void 0===o&&(o="power1"),!this.isMoving()){var r=this.getWorldCoordinates(),s={px:r.position.x,py:r.position.y,pz:r.position.z,qx:r.quaternion.x,qy:r.quaternion.y,qz:r.quaternion.z,qw:r.quaternion.w},h={px:t.x,py:t.y,pz:t.z,qx:e.x,qy:e.y,qz:e.z,qw:e.w};i.TweenMax.to(s,d(d({duration:n,ease:o},h),{onStart:function(){a.inTransit=!0,a.disassemble(),a.dispatchEvent({type:"CameraMoveStart"})},onUpdate:function(){var t;t=this,a.camera.position.set(s.px,s.py,s.pz),a.camera.quaternion.set(s.qx,s.qy,s.qz,s.qw),a.dispatchEvent({type:"CameraMoveUpdate",progress:t.progress()})},onComplete:function(){a.assemble(),a.inTransit=!1,a.dispatchEvent({type:"CameraMoveEnd"})}}))}},a.prototype.flyToKeyframe=function(t,e,n){var o=this;if(void 0===e&&(e=1),void 0===n&&(n="power1"),this.hasAnimation&&!this.isMoving()){var a={time:this.mixer.time},r={time:this.animationClip.tracks[0].times[t]};i.TweenMax.to(a,d(d({duration:e,ease:n},r),{onStart:function(){o.inTransit=!0,o.dispatchEvent({type:"CameraMoveStart"})},onUpdate:function(){var t;t=this,o.mixer.setTime(a.time),o.dispatchEvent({type:"CameraMoveUpdate",progress:t.progress()})},onComplete:function(){o.inTransit=!1,o.dispatchEvent({type:"CameraMoveEnd"})}}))}},a.prototype.setAnimationPercentage=function(t){if(this.hasAnimation){var e=Math.max(0,Math.min(t*this.animationClip.duration,this.animationClip.duration-1e-4));this.mixer.setTime(e)}},a.prototype.setAnimationTime=function(t){this.hasAnimation&&this.mixer.setTime(t)},a.prototype.setAnimationKeyframe=function(t){this.hasAnimation&&this.mixer.setTime(this.animationClip.tracks[0].times[t])},a}(e.EventDispatcher),g=function(t){function e(){return t.call(this)||this}return o(e,t),e}(e.EventDispatcher),v=function(t){function e(e){var i=t.call(this)||this;i.dampingFactor=.5,i.incrementor=1,i.keyMapping={up:["ArrowUp","w","W"],down:["ArrowDown","s","S"],left:["ArrowLeft","a","A"],right:["ArrowRight","d","D"]},i.preventBubbling=!0,Object.assign(i,e);var n={};for(var o in i.keyMapping)n[o]=0;return i.damper=new l({values:n,dampingFactor:i.dampingFactor}),i.onKeyUp=i.onKeyUp.bind(i),i.onKeyDown=i.onKeyDown.bind(i),i}return o(e,t),e.prototype.connect=function(){document.addEventListener("keyup",this.onKeyUp,!0),document.addEventListener("keydown",this.onKeyDown,!0),this.connected=!0},e.prototype.disconnect=function(){document.removeEventListener("keyup",this.onKeyUp,!0),document.removeEventListener("keydown",this.onKeyDown,!0),this.connected=!1},e.prototype.update=function(){"continuous"!==this.type||this.damper.reachedTarget()||(this.damper.update(),this.dispatchEvent({type:"update",values:this.damper.getCurrentValues(),deltas:this.damper.getDeltaValues()}),this.damper.reachedTarget()&&(this.damper.resetAll(0),this.dispatchEvent({type:"inertiacomplete"})))},e.prototype.isEnabled=function(){return this.connected},e.prototype.onKeyUp=function(t){if("discrete"===this.type)for(var e in this.keyMapping)if(this.keyMapping[e].includes(t.key)){this.preventBubbling&&t.preventDefault(),this.dispatchEvent({type:"trigger",trigger:e});break}},e.prototype.onKeyDown=function(t){if("continuous"===this.type)for(var e in this.keyMapping)if(this.keyMapping[e].includes(t.key)){this.preventBubbling&&t.preventDefault(),this.damper.addToTarget(e,this.incrementor);break}},e}(g),y=function(t){function e(e){var i=t.call(this)||this;return i.dampingFactor=.5,i.domElement=document.body,i.shouldNormalize=!0,i.normalizeAroundZero=!0,i.pointerCount=0,i.recordedPosition=!1,i.cache=[],i.lastDownTime=0,i.lastUpTime=0,i.multipointerThreshold=100,Object.assign(i,e),i.damper=new l({values:{x:null,y:null},dampingFactor:i.dampingFactor}),i.setDimensions(),i.onPointerMove=i.onPointerMove.bind(i),i.onPointerUp=i.onPointerUp.bind(i),i.onPointerDown=i.onPointerDown.bind(i),i.onResize=i.onResize.bind(i),i}return o(e,t),e.prototype.connect=function(){this.domElement.addEventListener("pointermove",this.onPointerMove,{passive:!0}),this.domElement.addEventListener("pointerdown",this.onPointerDown,{passive:!0}),this.domElement.addEventListener("pointerleave",this.onPointerUp,{passive:!0}),this.domElement.addEventListener("pointerup",this.onPointerUp,{passive:!0}),window.addEventListener("resize",this.onResize),this.connected=!0},e.prototype.disconnect=function(){this.domElement.removeEventListener("pointermove",this.onPointerMove),this.domElement.removeEventListener("pointerdown",this.onPointerDown),this.domElement.removeEventListener("pointerleave",this.onPointerUp),this.domElement.removeEventListener("pointerup",this.onPointerUp),this.connected=!1},e.prototype.update=function(t){this.pointerCount!==this.cache.length&&t-this.lastDownTime>this.multipointerThreshold&&t-this.lastUpTime>this.multipointerThreshold&&(this.pointerCount=this.cache.length,0===this.pointerCount?(this.damper.resetAll(null),this.recordedPosition=!1):(this.damper.resetData(this.getPointerPosition(this.cache[0])),this.recordedPosition=!0)),this.damper.reachedTarget()||(this.damper.update(),this.dispatchEvent({type:"update",values:this.shouldNormalize?this.normalize(this.damper.getCurrentValues(),this.normalizeAroundZero):this.damper.getCurrentValues(),deltas:this.shouldNormalize?this.normalize(this.damper.getDeltaValues(),!1):this.damper.getDeltaValues(),pointerCount:this.pointerCount}),this.damper.reachedTarget()&&this.dispatchEvent({type:"inertiacomplete"}))},e.prototype.isEnabled=function(){return this.connected},e.prototype.setDimensions=function(){this.width=this.domElement.getBoundingClientRect().width,this.height=this.domElement.getBoundingClientRect().height},e.prototype.getPointerPosition=function(t){return{x:Math.max(0,Math.min(this.width,t.x-this.domElement.offsetLeft)),y:Math.max(0,Math.min(this.height,t.y-this.domElement.offsetTop))}},e.prototype.normalize=function(t,e){var i=t.x/this.width,n=t.y/this.height;return e&&(i=2*i-1,n=2*n-1),{x:i,y:n}},e.prototype.onPointerMove=function(t){this.pointerCount===this.cache.length&&(0===this.cache.length?this.recordedPosition?this.damper.setTarget(this.getPointerPosition(t)):(this.damper.resetData(this.getPointerPosition(t)),this.recordedPosition=!0):t.pointerId===this.cache[0].pointerId&&this.damper.setTarget(this.getPointerPosition(t)))},e.prototype.onPointerDown=function(t){0===t.button&&(this.cache.push(t),this.lastDownTime=window.performance.now())},e.prototype.onPointerUp=function(t){if(0===t.button||"pointerleave"===t.type){for(var e=0;e<this.cache.length;e++)if(this.cache[e].pointerId==t.pointerId){this.cache.splice(e,1);break}this.lastUpTime=window.performance.now()}},e.prototype.onResize=function(){this.setDimensions()},e}(g),f=function(t){function e(e){var i=t.call(this)||this;return i.dampingFactor=.5,i.isIntersecting=!1,Object.assign(i,e),i.values={head:0,body:0,foot:0,total:0},i.lastSeenScrollValue=0,i.damper=new l({values:i.values,dampingFactor:i.dampingFactor}),i.onIntersected=i.onIntersected.bind(i),i.observer=new IntersectionObserver(i.onIntersected),i}return o(e,t),e.prototype.connect=function(){this.observer.observe(this.scrollElement),this.connected=!0},e.prototype.disconnect=function(){this.observer.unobserve(this.scrollElement),this.connected=!1},e.prototype.update=function(){if(this.isIntersecting&&this.lastSeenScrollValue!==(this.scrollParent?this.scrollParent.scrollTop:window.scrollY)){this.lastSeenScrollValue=this.scrollParent?this.scrollParent.scrollTop:window.scrollY;var t=this.scrollElement.getBoundingClientRect();this.values.head=this.normalize(t.top,window.innerHeight,0),this.values.foot=this.normalize(t.bottom,window.innerHeight,0),this.values.body=this.normalize(t.top,0,window.innerHeight-t.height),this.values.total=this.normalize(t.top,window.innerHeight,-t.height),this.damper.setTarget(this.values)}this.damper.reachedTarget()||(this.damper.update(),this.dispatchEvent({type:"update",dampenedValues:this.damper.getCurrentValues(),values:this.values}),this.damper.reachedTarget()&&this.dispatchEvent({type:"inertiacomplete"}))},e.prototype.isEnabled=function(){return this.connected},e.prototype.normalize=function(t,e,i){var n=(t-e)/(i-e);return Math.max(0,Math.min(1,n))},e.prototype.onIntersected=function(t){var e=t[0];this.isIntersecting=e.isIntersecting},e}(g),A=function(t){function e(e){void 0===e&&(e={});var i=t.call(this)||this;return i.domElement=document.body,i.thresholdX=60,i.thresholdY=60,Object.assign(i,e),i.onPointerUp=i.onPointerUp.bind(i),i.onPointerDown=i.onPointerDown.bind(i),i}return o(e,t),e.prototype.connect=function(){this.domElement.addEventListener("pointerdown",this.onPointerDown,{passive:!0}),this.domElement.addEventListener("pointerup",this.onPointerUp,{passive:!0}),this.connected=!0},e.prototype.disconnect=function(){this.domElement.removeEventListener("pointerdown",this.onPointerDown),this.domElement.removeEventListener("pointerup",this.onPointerUp),this.connected=!1},e.prototype.update=function(){},e.prototype.isEnabled=function(){return this.connected},e.prototype.onPointerDown=function(t){"mouse"!==t.pointerType&&t.isPrimary&&(this.startX=t.screenX,this.startY=t.screenY)},e.prototype.onPointerUp=function(t){if("mouse"!==t.pointerType&&t.isPrimary){var e=t.screenX-this.startX,i=t.screenY-this.startY;(Math.abs(e)>=this.thresholdX||Math.abs(i)>=this.thresholdY)&&this.dispatchEvent({type:"trigger",x:Math.abs(e)>=this.thresholdX?Math.sign(e):0,y:Math.abs(i)>=this.thresholdY?Math.sign(-1*i):0})}},e}(g),b=function(t){function e(e){var i=t.call(this)||this;return i.dampingFactor=.5,i.thresholdX=15,i.thresholdY=15,i.debounceDuration=700,i.lastThresholdTrigger=0,Object.assign(i,e),i.damper=new l({values:{x:0,y:0},dampingFactor:i.dampingFactor}),i.onWheel=i.onWheel.bind(i),i}return o(e,t),e.prototype.connect=function(){(this.domElement||window).addEventListener("wheel",this.onWheel,{passive:!0}),this.connected=!0},e.prototype.disconnect=function(){(this.domElement||window).removeEventListener("wheel",this.onWheel),this.connected=!1},e.prototype.update=function(){"continuous"!==this.type||this.damper.reachedTarget()||(this.damper.update(),this.dispatchEvent({type:"update",values:this.damper.getCurrentValues(),deltas:this.damper.getDeltaValues()}),this.damper.reachedTarget()&&(this.damper.resetAll(0),this.dispatchEvent({type:"inertiacomplete"})))},e.prototype.isEnabled=function(){return this.connected},e.prototype.onWheel=function(t){if("continuous"===this.type)this.damper.addToTarget("x",t.deltaX),this.damper.addToTarget("y",t.deltaY);else if("discrete"===this.type&&(Math.abs(t.deltaX)>=this.thresholdX||Math.abs(t.deltaY)>=this.thresholdY)){var e=window.performance.now();e-this.lastThresholdTrigger>this.debounceDuration&&(this.lastThresholdTrigger=e,this.dispatchEvent({type:"trigger",x:Math.abs(t.deltaX)>=this.thresholdX?Math.sign(t.deltaX):0,y:Math.abs(t.deltaY)>=this.thresholdY?Math.sign(t.deltaY):0}))}},e}(g),C=function(){function e(t,e){void 0===e&&(e={}),this.enabled=!1,this.cameraRig=t,this.wheelScaleFactor=e.wheelScaleFactor||.05,this.pointerScaleFactor=e.pointerScaleFactor||4,this.panDegreeFactor=e.panDegreeFactor||Math.PI/4,this.tiltDegreeFactor=e.tiltDegreeFactor||Math.PI/10,this.keyboardAdaptor=new v({type:"continuous",dampingFactor:e.keyboardDampFactor||.5,incrementor:e.keyboardScaleFactor||.5,keyMapping:{forward:["ArrowUp","w","W"],backward:["ArrowDown","s","S"],left:["ArrowLeft","a","A"],right:["ArrowRight","d","D"],up:["t","T"],down:["b","B"]}}),this.wheelAdaptor=new b({type:"continuous",dampingFactor:e.wheelDampFactor||.25,domElement:e.domElement||document.body}),this.pointerAdaptor=new y({dampingFactor:e.pointerDampFactor||.3}),this.onWheel=this.onWheel.bind(this),this.onKey=this.onKey.bind(this),this.onPointer=this.onPointer.bind(this)}return e.prototype.isEnabled=function(){return this.enabled},e.prototype.enable=function(){this.wheelAdaptor.connect(),this.keyboardAdaptor.connect(),this.pointerAdaptor.connect(),this.wheelAdaptor.addEventListener("update",this.onWheel),this.keyboardAdaptor.addEventListener("update",this.onKey),this.pointerAdaptor.addEventListener("update",this.onPointer),this.enabled=!0},e.prototype.disable=function(){this.wheelAdaptor.disconnect(),this.keyboardAdaptor.disconnect(),this.pointerAdaptor.disconnect(),this.wheelAdaptor.removeEventListener("update",this.onWheel),this.keyboardAdaptor.removeEventListener("update",this.onKey),this.pointerAdaptor.removeEventListener("update",this.onPointer),this.enabled=!1},e.prototype.onWheel=function(e){this.cameraRig.do(t.CameraAction.Dolly,e.deltas.y*this.wheelScaleFactor),this.cameraRig.do(t.CameraAction.Truck,e.deltas.x*this.wheelScaleFactor)},e.prototype.onKey=function(e){this.cameraRig.do(t.CameraAction.Dolly,e.values.backward-e.values.forward),this.cameraRig.do(t.CameraAction.Truck,e.values.right-e.values.left),this.cameraRig.do(t.CameraAction.Pedestal,e.values.up-e.values.down)},e.prototype.onPointer=function(e){switch(e.pointerCount){case 1:this.cameraRig.do(t.CameraAction.Pan,e.deltas.x*this.panDegreeFactor),this.cameraRig.do(t.CameraAction.Tilt,e.deltas.y*this.tiltDegreeFactor);break;case 2:this.cameraRig.do(t.CameraAction.Dolly,-e.deltas.y*this.pointerScaleFactor),this.cameraRig.do(t.CameraAction.Truck,-e.deltas.x*this.pointerScaleFactor)}},e.prototype.update=function(t){this.enabled&&(this.keyboardAdaptor.update(),this.wheelAdaptor.update(),this.pointerAdaptor.update(t))},e}(),E=function(){function t(t,e){this.enabled=!1,this.cameraRig=t,this.cameraRig.setAnimationTime(0),this.scrollAdaptor=new f({scrollElement:e.scrollElement,scrollParent:e.scrollParent,dampingFactor:e.dampingFactor||1}),this.onScroll=this.onScroll.bind(this)}return t.prototype.isEnabled=function(){return this.enabled},t.prototype.enable=function(){this.scrollAdaptor.connect(),this.scrollAdaptor.addEventListener("update",this.onScroll),this.enabled=!0},t.prototype.disable=function(){this.scrollAdaptor.disconnect(),this.scrollAdaptor.removeEventListener("update",this.onScroll),this.enabled=!1},t.prototype.update=function(){this.enabled&&this.scrollAdaptor.update()},t.prototype.onScroll=function(t){this.cameraRig.setAnimationPercentage(t.values.total)},t}(),x=function(t){function e(e,i,n){void 0===i&&(i=[]),void 0===n&&(n={});var o=t.call(this)||this;return o.currentIndex=null,o.upcomingIndex=null,o.enabled=!1,o.cycle=!1,o.cameraRig=e,o.pois=i,Object.assign(o,n),o.onCameraStart=o.onCameraStart.bind(o),o.onCameraUpdate=o.onCameraUpdate.bind(o),o.onCameraEnd=o.onCameraEnd.bind(o),o}return o(e,t),e.prototype.getCurrentIndex=function(){return this.currentIndex},e.prototype.nextPOI=function(){var t=this.currentIndex+1;t>=this.pois.length&&!this.cycle?this.dispatchEvent({type:"ExitStoryPoints",exitFrom:"end"}):this.goToPOI(t%this.pois.length)},e.prototype.prevPOI=function(){var t=this.currentIndex-1;t<0&&!this.cycle?this.dispatchEvent({type:"ExitStoryPoints",exitFrom:"start"}):this.goToPOI((t+this.pois.length)%this.pois.length)},e.prototype.goToPOI=function(t){this.upcomingIndex=t;var e=this.pois[this.upcomingIndex];this.cameraRig.flyTo(e.lookAtPosition,e.lookAtOrientation,this.duration,this.ease)},e.prototype.enable=function(){this.cameraRig.addEventListener("CameraMoveStart",this.onCameraStart),this.cameraRig.addEventListener("CameraMoveUpdate",this.onCameraUpdate),this.cameraRig.addEventListener("CameraMoveEnd",this.onCameraEnd),this.enabled=!0},e.prototype.disable=function(){this.cameraRig.removeEventListener("CameraMoveStart",this.onCameraStart),this.cameraRig.removeEventListener("CameraMoveUpdate",this.onCameraUpdate),this.cameraRig.removeEventListener("CameraMoveEnd",this.onCameraEnd),this.enabled=!1},e.prototype.update=function(){},e.prototype.isEnabled=function(){return this.enabled},e.prototype.updatePois=function(t){this.dispatchEvent({type:"update",currentIndex:this.currentIndex,upcomingIndex:this.upcomingIndex,progress:t})},e.prototype.onCameraStart=function(){this.updatePois(0)},e.prototype.onCameraUpdate=function(t){this.updatePois(t.progress)},e.prototype.onCameraEnd=function(){this.currentIndex=this.upcomingIndex,this.upcomingIndex=null},e}(e.EventDispatcher),w=function(t){function e(e,i,n){void 0===i&&(i=[]),void 0===n&&(n={});var o=t.call(this)||this;return o.currentIndex=0,o.upcomingIndex=null,o.enabled=!1,o.wheelThreshold=15,o.swipeThreshold=60,o.cameraRig=e,o.pois=i,Object.assign(o,n),o.wheelAdaptor=new b({type:"discrete",thresholdY:o.wheelThreshold}),o.swipeAdaptor=new A({thresholdY:o.swipeThreshold}),o.keyboardAdaptor=new v({type:"discrete"}),o.onCameraStart=o.onCameraStart.bind(o),o.onCameraUpdate=o.onCameraUpdate.bind(o),o.onCameraEnd=o.onCameraEnd.bind(o),o.onTrigger=o.onTrigger.bind(o),o.onKey=o.onKey.bind(o),o}return o(e,t),e.prototype.getCurrentIndex=function(){return this.currentIndex},e.prototype.enable=function(){this.wheelAdaptor.addEventListener("trigger",this.onTrigger),this.swipeAdaptor.addEventListener("trigger",this.onTrigger),this.keyboardAdaptor.addEventListener("trigger",this.onKey),this.cameraRig.addEventListener("CameraMoveStart",this.onCameraStart),this.cameraRig.addEventListener("CameraMoveUpdate",this.onCameraUpdate),this.cameraRig.addEventListener("CameraMoveEnd",this.onCameraEnd),this.wheelAdaptor.connect(),this.swipeAdaptor.connect(),this.keyboardAdaptor.connect(),this.enabled=!0},e.prototype.disable=function(){this.wheelAdaptor.removeEventListener("trigger",this.onTrigger),this.swipeAdaptor.removeEventListener("trigger",this.onTrigger),this.keyboardAdaptor.removeEventListener("trigger",this.onKey),this.cameraRig.removeEventListener("CameraMoveStart",this.onCameraStart),this.cameraRig.removeEventListener("CameraMoveUpdate",this.onCameraUpdate),this.cameraRig.removeEventListener("CameraMoveEnd",this.onCameraEnd),this.wheelAdaptor.disconnect(),this.swipeAdaptor.disconnect(),this.keyboardAdaptor.disconnect(),this.enabled=!1},e.prototype.update=function(){},e.prototype.isEnabled=function(){return this.enabled},e.prototype.onKey=function(t){switch(t.trigger){case"up":this.onTrigger({y:-1});break;case"down":this.onTrigger({y:1})}},e.prototype.onTrigger=function(t){var e=this.currentIndex+t.y;e>=this.pois.length?this.dispatchEvent({type:"ExitPathPoints",exitFrom:"end"}):e<0?this.dispatchEvent({type:"ExitPathPoints",exitFrom:"start"}):(this.upcomingIndex=e,this.cameraRig.flyToKeyframe(this.pois[this.upcomingIndex].frame,this.duration,this.ease))},e.prototype.updatePois=function(t){this.dispatchEvent({type:"update",currentIndex:this.currentIndex,upcomingIndex:this.upcomingIndex,progress:t})},e.prototype.onCameraStart=function(){this.updatePois(0)},e.prototype.onCameraUpdate=function(t){this.updatePois(t.progress)},e.prototype.onCameraEnd=function(){this.currentIndex=this.upcomingIndex,this.upcomingIndex=null},e}(e.EventDispatcher),P=function(){function e(t,e){void 0===e&&(e={}),this.enabled=!1,this.panFactor=Math.PI/20,this.tiltFactor=Math.PI/20,this.truckFactor=1,this.pedestalFactor=1,this.dampingFactor=.7,this.cameraRig=t,Object.assign(this,e),this.pointerAdaptor=new y({dampingFactor:this.dampingFactor}),this.onPointerMove=this.onPointerMove.bind(this)}return e.prototype.isEnabled=function(){return this.enabled},e.prototype.enable=function(){this.pointerAdaptor.connect(),this.pointerAdaptor.addEventListener("update",this.onPointerMove),this.enabled=!0},e.prototype.disable=function(){this.pointerAdaptor.disconnect(),this.pointerAdaptor.removeEventListener("update",this.onPointerMove),this.enabled=!1},e.prototype.update=function(t){this.enabled&&this.pointerAdaptor.update(t)},e.prototype.onPointerMove=function(e){0===e.pointerCount&&(this.cameraRig.do(t.CameraAction.Pan,-e.deltas.x*this.panFactor),this.cameraRig.do(t.CameraAction.Tilt,-e.deltas.y*this.tiltFactor),this.cameraRig.do(t.CameraAction.LocalTruck,e.deltas.x*this.truckFactor),this.cameraRig.do(t.CameraAction.LocalPedestal,e.deltas.y*this.pedestalFactor))},e}();t.BaseAdaptor=g,t.CameraRig=u,t.Damper=l,t.FreeMovementControls=C,t.KeyboardAdaptor=v,t.PathPointsControls=w,t.PointerAdaptor=y,t.ScrollAdaptor=f,t.ScrollControls=E,t.StoryPointsControls=x,t.SwipeAdaptor=A,t.ThreeDOFControls=P,t.WheelAdaptor=b,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=threebird-controls.min.js.map
